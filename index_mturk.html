<!doctype html>
<html>
<head>

  <link rel="icon" href="data:,">
  <meta charset="utf-8">
  <title>HEMVIP</title>
  <meta name="description" content="HEMVIP (based on webMUSHRA) by Patrik Jonell and contributors">
  <meta name="author" content="Patrik Jonell and contributors">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link type="text/css" href="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/design/jquery.mobile-theme/themes/default/jquery.mobile.icons.min.css" rel="stylesheet" />
  <link type="text/css" href="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/external/jquery.mobile/jquery.mobile-1.4.4.css" rel="stylesheet" />
  <link type="text/css" href="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/design/jquery.mobile-theme/themes/default/alabs_0_3.css" rel="stylesheet" />
  <link type="text/css"
    href="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/external/jquery.mobile/plugins/jQuery-Mobile-Progress-Bar-with-Percentage/src/css/tolito-1.0.1.css"
    rel="stylesheet" />
  <link type="text/css"
    href="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/external/jquery.mobile/plugins/jQuery-Mobile-Icon-Pack/original/jqm-icon-pack-2.0-original.css"
    rel="stylesheet" />
  <link type="text/css" href="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/external/wmSlider/slider.min.css" rel="stylesheet" />
  <link type="text/css" href="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/external/wmSlider/slider.pips.css" rel="stylesheet" />

  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/external/jquery/jquery-2.1.1.min.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/external/jquery.mobile/jquery.mobile-1.4.4.js"></script>
  <script
    src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/external/jquery.mobile/plugins/jQuery-Mobile-Progress-Bar-with-Percentage/src/js/tolito-1.0.1.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/external/jquery.mobile/patches/vertical-slider.js"></script>



  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/external/wmSlider/slider.min.js"></script>

  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/external/mousetrap/mousetrap.min.js"></script>

  <script>
    var nls = new Object();
  </script>

  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/video/VideoVisualizer.js"></script>

  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/business/DataSender.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/business/ErrorHandler.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/business/PageManager.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/business/PageTemplateRenderer.js"></script>

  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/datamodel/MUSHRARating.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/datamodel/Participant.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/datamodel/Session.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/datamodel/Stimulus.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/datamodel/Trial.js"></script>

  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/misc/LikertScale.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/misc/Localizer.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/misc/Shuffle.js"></script>

  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/pages/FinishPage.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/pages/GenericPage.js"></script>
  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/pages/VideoPage.js"></script>



  <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/lib/webmushra/nls/nls.js"></script>


  <script src="https://player.vimeo.com/api/player.js"></script>

  <link rel="stylesheet" href="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/design/style.css">
</head>

<body data-theme="a">

  <div class="header" id="header"></div>

  <div id="container">

    <div id="page_progressbar"></div>
    <h3 class="ui-bar ui-bar-a ui-corner-all" id="page_header"></h3>
    <div class="ui-body ui-body-a ui-corner-all" id="page_content">
    </div>
    <br />
    <div class="ui-body ui-body-a ui-corner-all" id="page_navigation">
    </div>
  </div>

  
  <div data-role="popup" data-dismissible="false" data-history="false" data-transition="flip" positionTo="window"
    id="popupErrors">
    <div id="popupErrorsContent">Errors:<br /></div>
  </div>

  <div data-role="popup" data-history="false" data-position-to="#page_content" data-transition="slidedown"
    id="popupDialog" data-overlay-theme="a" data-theme="c" data-dismissible="false" class="ui-corner-all">
    <div data-role="header" class="ui-corner-top" style="width : 57.5em; background-color: #FFb500;">
      <h1 id="popHeader"></h1>
    </div>
    <div id="popupResultsContent" style="background-color: white;" class="ui-corner-bottom ui-content">
    </div>
  </div>
  <!-- build:js:generic startup.min.js -->



  <button onclick="handleFormSubmit()">Submit</button>
  	<!-- <form method="post" id="mturk_form" action="https://www.mturk.com/mturk/externalSubmit"> -->
	<form method="post" id="mturk_form" action="https://workersandbox.mturk.com/mturk/externalSubmit">
		<input type="hidden" id="inputAssignmentId" name="assignmentId">
		<input type="hidden" id="inputEvaluationValue1" name="evaluationValue1">
		<input type="hidden" id="inputEvaluationValue2" name="evaluationValue2">
		<input type="hidden" id="inputEvaluationValue3" name="evaluationValue3">
		<input type="hidden" id="inputEvaluationValue4" name="evaluationValue4">
  	</form>

  


  <script type="text/javascript">

  function handleFormSubmit() {
    const urlParams = new URLSearchParams(window.location.search)
    document.getElementById('inputAssignmentId').value = urlParams.get('assignmentId')
    document.getElementById('inputEvaluationValue1').value = document.getElementsByClassName("ui-slider-handle ui-btn ui-shadow")[0].getAttribute('aria-valuenow');
    document.getElementById('inputEvaluationValue2').value = document.getElementsByClassName("ui-slider-handle ui-btn ui-shadow")[1].getAttribute('aria-valuenow');
    document.getElementById('inputEvaluationValue3').value = document.getElementsByClassName("ui-slider-handle ui-btn ui-shadow")[2].getAttribute('aria-valuenow');
    document.getElementById('inputEvaluationValue4').value = document.getElementsByClassName("ui-slider-handle ui-btn ui-shadow")[3].getAttribute('aria-valuenow');
    document.getElementById('mturk_form').submit()
    }

  //when changing from portrait to landscape change to the right width
  function checkOrientation() {
    var siteWidth = document.body.scrollWidth;
    $("#header").css("width", siteWidth.toString());
  }

  window.onresize = function (event) {
    if (pageManager && pageManager.getCurrentPage() && pageManager.getCurrentPage().isMushra == true) {
      pageManager.getCurrentPage().renderCanvas("mushra_items");
    }

    checkOrientation();
  };

  // callbacks
  function callbackFilesLoaded() {
    pageManager.start();
    pageTemplateRenderer.renderProgressBar(("page_progressbar"));
    pageTemplateRenderer.renderHeader(("page_header"));
    pageTemplateRenderer.renderNavigation(("page_navigation"));

    if (config.stopOnErrors == false || !errorHandler.errorOccurred()) {
      $.mobile.loading("hide");
      $("body").children().children().removeClass('ui-disabled');
    } else {
      var errors = errorHandler.getErrors();
      var ul = $("<ul style='text-align:left;'></ul>");
      $('#popupErrorsContent').append(ul);
      for (var i = 0; i < errors.length; ++i) {
        ul.append($('<li>' + errors[i] + '</li>'));
      }
      // $("#popupErrors").popup("open");
      $.mobile.loading("hide");
    }

    if ($.mobile.activePage) {
      $.mobile.activePage.trigger('create');
    }
  }

  function callbackURLFound() {
    var errors = errorHandler.getErrors();
    var ul = $("<ul style='text-align:left;'></ul>");
    $('#popupErrorsContent').append(ul);
    for (var i = 0; i < errors.length; ++i) {
      ul.append($('<li>' + errors[i] + '</li>'));
    }
    // $("#popupErrors").popup("open");
  }

  function addPagesToPageManager(_pageManager, _pages) {
    for (var i = 0; i < _pages.length; ++i) {
      if (Array.isArray(_pages[i])) {
        if (_pages[i][0] === "random") {
          _pages[i].shift();
          shuffle(_pages[i]);
        }
        addPagesToPageManager(_pageManager, _pages[i]);
      } else {
        var pageConfig = _pages[i];
        if (pageConfig.type == "generic") {
          _pageManager.addPage(new GenericPage(_pageManager, pageConfig));
        } else if (pageConfig.type == "video") {
          var videoPage = new VideoPage(_pageManager, pageTemplateRenderer, session, config, pageConfig, errorHandler, config.language);
          _pageManager.addPage(videoPage);
        } else if (pageConfig.type == "finish") {
          var finishPage = new FinishPage(_pageManager, session, dataSender, pageConfig, config.language);
          _pageManager.addPage(finishPage);
        } else {

          errorHandler.sendError("Type not specified.");

        }
      }
    }
  }

  for (var i = 0; i < $("body").children().length; i++) {
    if ($("body").children().eq(i).attr('id') != "popupErrors" && $("body").children().eq(i).attr('id') != "popupDialog") {
      $("body").children().eq(i).addClass('ui-disabled');
    }
  }


  function startup(config) {


    if (config == null) {
      errorHandler.sendError("URL couldn't be found!");
      callbackURLFound();
    }

    if ($(window).width() < 1100) {
      errorHandler.sendError("Please use a computer for this experiment.");
    }

    if (navigator.appName == 'Microsoft Internet Explorer') {
      errorHandler.sendError("Please do not use internet explorer for this experiment.");
    }

    $.mobile.page.prototype.options.theme = 'a';
    var interval = setInterval(function () {
      $.mobile.loading("show", {
        text: "Loading...",
        textVisible: true,
        theme: "a",
        html: ""
      });
      clearInterval(interval);
    }, 1);


    if (pageManager !== null) { // clear everything for new experiment
      pageTemplateRenderer.clear();
      $("#page_content").empty();
      $('#header').empty();
    }

    localizer = new Localizer();
    localizer.initializeNLSFragments(nls);

    pageManager = null;
    dataSender = null;
    session = null;
    pageTemplateRenderer = null;
    interval2 = null;

    document.title = config.testname;
    $('#header').append(document.createTextNode(config.testname));

    pageManager = new PageManager("pageManager", "page_content", localizer);

    dataSender = new DataSender(config);

    session = new Session();
    session.testId = config.testId;
    session.userId = config.userId;
    session.config = configFile;
    session.navigator = navigator.userAgent.replaceAll(";", " -")

    if (config.language == undefined) {
      config.language = 'en';
    }
    pageTemplateRenderer = new PageTemplateRenderer(pageManager, config.showButtonPreviousPage, config.language);
    pageManager.addCallbackPageEventChanged(pageTemplateRenderer.refresh.bind(pageTemplateRenderer));

    addPagesToPageManager(pageManager, config.pages);

    setTimeout(function () {
      callbackFilesLoaded()
    }, 10);
  }

  // start code (loads config) 

  var config = null;
  // var configArg = getParameterByName("config");
  var configFile = '';

  function getParameterByName(name) {
    var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
    return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
  }
  var userId = "config2.json";
  var testId = "my_second_experiment";

  configFile = '/configs/' + testId + "/" + userId;

  var config = 
    {
      "testname": "Experiment",
      "testId": "gesture_experiment",
      "stopOnErrors": false,
      "remoteService": "/save",
      "pages": [
          {
              "type": "video",
              "id" : "subject_x_1",
              "name" : "Page 1 of Y",
              "content" : "Rate the videos shown below",
              "question" : "How human-like was the agent in this video?",
              "stimuli": [
                  [
                    "C1",
                    "0"
                  ],
                  [
                    "C2",
                    "0"
                  ],
                  [
                    "C3",
                    "0"
                  ],
                  [
                    "C4",
                    "0"
                  ]
              ]
          }
      ]
    };

  config["pages"][0]["stimuli"][0][1] = "${vid1}";
  config["pages"][0]["stimuli"][1][1] = "${vid2}";
  config["pages"][0]["stimuli"][2][1] = "${vid3}";
  config["pages"][0]["stimuli"][3][1] = "${vid4}";

  // global variables
  var errorHandler = new ErrorHandler();
  var localizer = null;
  var pageManager = null;
  var dataSender = null;
  var session = null;
  var pageTemplateRenderer = null;
  var interval2 = null;

  startup(config);

  </script>

  <!-- <script src="https://klab-teshima-video-storage.s3.ap-northeast-1.amazonaws.com/hemvip/startup2.js"></script> -->
  <!-- /build -->
</body>

</html>